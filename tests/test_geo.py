from pycds import History

def test_can_use_spatial_tables(test_session):
    res = test_session.execute('SELECT ST_X(the_geom) AS lon FROM meta_history ORDER BY lon')
    lons = [ lon for lon, in res ]
    assert lons == [-130.4447, -129.483333333333, -129.216666666667, -129.081944444444,
                    -127.694444444444, -126.625, -126.562777777778, -125.99161111111111,
                    -125.966667, -125.694166666667, -125.3679, -125.133333, -124.8,
                    -124.210555555556, -124.133333, -123.999722222222, -123.6,
                    -123.48333333333333, -123.26472222222222, -123.2647, -123.194444444444,
                    -123.066667, -122.8, -122.533333, -121.578611111111, -121.4, -121.233333,
                    -121.209722222222, -121.113333333333, -120.873611111111, -120.75, -120.333,
                    -120.233333333333, -120.045, -119.60222222222222, -119.506666666667,
                    -119.469444444444, -119.420833333333, -119.25, -119.1942667, -119.164444444444,
                    -118.766111111111, -118.75, -117.811944444444, -117.22867, -117.0,
                    -116.531666666667, -116.4, -116.337777777778, -115.828055555556]

def test_can_use_spatial_types(test_session):
    points = test_session.query(History.the_geom)
    lats = [ test_session.scalar(point.the_geom.y) for point in  points ]
    assert set(lats) == set([49.333333, 50.453472222222224, 49.433333, 55.4138888888889,
                             50.4005555555556, 50.04931, 49.6638888888889, 57.6166666666667,
                             54.7527777777778, 50.6276, 53.1088888888889, 53.3, 50.2133333333333,
                             50.2, 50.2613888888889, 58.65, 49.6041666666667, 49.33028, 49.516666666666666,
                             53.3, 49.135, 51.6138888888889, 49.166667, 49.33027777777778, 49.65,
                             59.4583333333333, 51.0, 55.566667, 52.4305555555556, 49.463055555555556,
                             49.0083333333333, 49.5, 50.6536111111111, 53.0983333333333, 49.41, 49.0125,
                             51.3, 56.3188, 48.8, 54.9425, 55.9402777777778, 54.0563888888889, 55.466667,
                             55.6619444444444, 49.9347222222222, 49.1141666666667, 50.4, 55.2486111111111,
                             50.9, 54.2925])
